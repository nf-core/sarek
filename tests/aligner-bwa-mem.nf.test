nextflow_pipeline {

    name "Test pipeline"
    script "../main.nf"
    tag "pipeline"
    tag "pipeline_sarek"
    tag "cpu"

    def test_scenario = [
        [
            name: "-profile test --aligner bwa-mem --save_reference skip QC/recal/md",
            params: [
                aligner: 'bwa-mem',
                save_reference: true,
                skip_tools: 'baserecalibrator,fastqc,markduplicates,mosdepth,multiqc,samtools',
                tools: ''
            ]
        ],
        [
            name: "-profile test --aligner bwa-mem --save_reference skip QC/recal/md -stub",
            params: [
                aligner: 'bwa-mem',
                save_reference: true,
                skip_tools: 'baserecalibrator,fastqc,markduplicates,mosdepth,multiqc,samtools',
                tools: ''
            ],
            stub: true
        ],
        [
            name: "-profile test --aligner bwa-mem --save_reference --build_only_index",
            params: [
                aligner: 'bwa-mem',
                build_only_index: true,
                input: false,
                save_reference: true,
                skip_tools: 'multiqc',
                tools: ''
            ]
        ],
        [
            name: "-profile test --aligner bwa-mem --save_reference --build_only_index -stub",
            params: [
                aligner: 'bwa-mem',
                build_only_index: true,
                input: false,
                save_reference: true,
                skip_tools: 'multiqc',
                tools: ''
            ],
            stub: true
        ]
    ]

    // Generate tests for each scenario
    test_scenario.each { scenario ->
        test(scenario.name, UTILS.get_test_closure(scenario))
    }
}
