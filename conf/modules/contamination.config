process {
    // Contaminant removal options
    withName: 'BBMAP_BBSPLIT' {
        ext.args   = 'build=1 ambiguous2=best maxindel=150000'
        ext.prefix = { params.split_fastq && reads ? "${reads[0].getName().tokenize('.')[0]}.${meta.id}" : "${meta.id}" }

        publishDir = [
            [
                path: { "${params.outdir}/preprocessing/bbsplit/${meta.id}" },
                mode: params.publish_dir_mode,
                pattern: '*.txt'
            ],
            [
                path: { params.save_bbsplit_reads ? "${params.outdir}/preprocessing/bbsplit/${meta.id}" : params.outdir },
                mode: params.publish_dir_mode,
                pattern: '*.fastq.gz',
                saveAs: { params.save_bbsplit_reads ? it : null }
            ]
        ]
    }
}
